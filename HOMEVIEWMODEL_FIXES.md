# ๐ง ุฅุตูุงุญ ูุดุงูู HomeViewModel

## ๐ ุชุงุฑูุฎ ุงูุฅุตูุงุญ: 6 ุฃูุชูุจุฑ 2025

---

## ๐ ุงููุดุงูู ุงูุชู ุชู ุงูุชุดุงููุง ูุฅุตูุงุญูุง

### ุงููุดููุฉ 1: ุฎุทุฃ ูู ุฏุงูุฉ `deletePost()` โ

#### ุงูููุฏ ุงููุฏูู (ุงููุดููุฉ):
```kotlin
fun deletePost(data: String) {
    viewModelScope.launch(Dispatchers.IO) {
        val postRequest = DeletePostRequest(postId = data)
        repository2.deletePost(postRequest).collectLatest { response ->
            _message.value = response

            if (response is DataState.Success) {
                val currentState = _posts.value
                if (currentState is DataState.Success) {
                    val updatedPosts = currentState.data.posts.filter { it.postId != data }
                    val newResponse = currentState.data.copy(posts = updatedPosts)
                    _posts.value = DataState.Success(newResponse)
                }
                clearAllStates()  // โ ููุง ุงููุดููุฉ: ููุณุญ ูู ุงูุจูุงูุงุช ุจูุง ูููุง ุงูููุดูุฑุงุช!
            }
        }
    }
}
```

#### ุงููุดุงูู ูู ุงูููุฏ ุงููุฏูู:
1. โ **ูุง ูุชู ุชุญุฏูุซ `allPosts`** - ุงููุงุฆูุฉ ุงูุชุฑุงูููุฉ ุชุจูู ุชุญุชูู ุนูู ุงูููุดูุฑ ุงููุญุฐูู
2. โ **ุงุณุชุฏุนุงุก `clearAllStates()`** - ููุณุญ ูู ุงูููุดูุฑุงุช ูู ุงูุดุงุดุฉ ุจุนุฏ ุงูุญุฐู
3. โ **ูุง ูุชู ุชุญุฏูุซ `totalPosts` ู `totalCurrent`** - ุงูุฃุนุฏุงุฏ ุชุจูู ุฎุงุทุฆุฉ

#### ุงูุญู โ:
```kotlin
fun deletePost(data: String) {
    viewModelScope.launch(Dispatchers.IO) {
        val postRequest = DeletePostRequest(postId = data)
        repository2.deletePost(postRequest).collectLatest { response ->
            _message.value = response

            if (response is DataState.Success) {
                // โ ุชุญุฏูุซ ุงููุงุฆูุฉ ุงูุชุฑุงูููุฉ
                allPosts.removeAll { it.postId == data }
                
                val currentState = _posts.value
                if (currentState is DataState.Success) {
                    val updatedPosts = allPosts.toList()
                    // โ ุชุญุฏูุซ ูู ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
                    val newResponse = currentState.data.copy(
                        posts = updatedPosts,
                        totalPosts = currentState.data.totalPosts - 1,
                        totalCurrent = updatedPosts.size
                    )
                    _posts.value = DataState.Success(newResponse)
                }
                // โ ูุณุญ ุฑุณุงูุฉ ุงููุฌุงุญ ููุทุ ูููุณ ูู ุงูุจูุงูุงุช
                clearMessageState()
            }
        }
    }
}
```

#### ุงูุชุญุณููุงุช:
โ ุชุญุฏูุซ `allPosts` ูุฅุฒุงูุฉ ุงูููุดูุฑ ุงููุญุฐูู  
โ ุชุญุฏูุซ `totalPosts` (ุชูููู ุงูุนุฏุฏ ุจู 1)  
โ ุชุญุฏูุซ `totalCurrent` ุจุนุฏุฏ ุงูููุดูุฑุงุช ุงูุญุงููุฉ  
โ ุงุณุชุฎุฏุงู `clearMessageState()` ุจุฏูุงู ูู `clearAllStates()`  
โ ุงูููุดูุฑุงุช ุชุจูู ูุนุฑูุถุฉ ุจุนุฏ ุงูุญุฐู  

---

### ุงููุดููุฉ 2: ุฎุทุฃ ูู ุฏุงูุฉ `addComment()` โ

#### ุงูููุฏ ุงููุฏูู (ุงููุดููุฉ):
```kotlin
fun addComment(request: AddCommentRequest) {
    viewModelScope.launch(Dispatchers.IO) {
        _message.value = DataState.Loading
        repository2.addComments(request).collectLatest { response ->
            _message.value = response

            if (response is DataState.Success) {
                fetchComments(request.postId)
                clearAllStates()  // โ ููุง ุงููุดููุฉ: ููุณุญ ูู ุงูููุดูุฑุงุช ูู ุงูุดุงุดุฉ!
            }
        }
    }
}
```

#### ุงููุดููุฉ:
โ **ุงุณุชุฏุนุงุก `clearAllStates()`** ุจุนุฏ ุฅุถุงูุฉ ุชุนููู ูุคุฏู ุฅูู:
- ูุณุญ ูู ุงูููุดูุฑุงุช ูู ุงูุดุงุดุฉ
- ุฅุนุงุฏุฉ ุชุนููู Pagination ูู ุงูุตูุฑ
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ

#### ุงูุญู โ:
```kotlin
fun addComment(request: AddCommentRequest) {
    viewModelScope.launch(Dispatchers.IO) {
        _message.value = DataState.Loading
        repository2.addComments(request).collectLatest { response ->
            _message.value = response

            if (response is DataState.Success) {
                fetchComments(request.postId)
                // โ ูุณุญ ุฑุณุงูุฉ ุงููุฌุงุญ ููุท
                clearMessageState()
            }
        }
    }
}
```

#### ุงูุชุญุณููุงุช:
โ ุงุณุชุฎุฏุงู `clearMessageState()` ุจุฏูุงู ูู `clearAllStates()`  
โ ุงูููุดูุฑุงุช ุชุจูู ูุนุฑูุถุฉ ุจุนุฏ ุฅุถุงูุฉ ุงูุชุนููู  
โ Pagination ูุจูู ููุง ูู  
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู  

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงูุฏุงูุฉ | ุงูุชุบููุฑ | ุงูุณุจุจ |
|--------|---------|--------|
| `deletePost()` | ุชุญุฏูุซ `allPosts` ูุจุงุดุฑุฉ | ููุญูุงุธ ุนูู ุชุฒุงูู ุงูุจูุงูุงุช |
| `deletePost()` | ุชุญุฏูุซ `totalPosts` ู `totalCurrent` | ูุนูุณ ุงูุนุฏุฏ ุงูุตุญูุญ |
| `deletePost()` | `clearAllStates()` โ `clearMessageState()` | ููุญูุงุธ ุนูู ุงูููุดูุฑุงุช ูุนุฑูุถุฉ |
| `addComment()` | `clearAllStates()` โ `clearMessageState()` | ููุญูุงุธ ุนูู ุงูููุดูุฑุงุช ูุนุฑูุถุฉ |

---

## ๐ฏ ุงููุงุฆุฏุฉ ูู ุงูุฅุตูุงุญุงุช

### ูุจู ุงูุฅุตูุงุญ โ:
```
1. ุงููุณุชุฎุฏู ูุญุฐู ููุดูุฑ
2. ุงูููุดูุฑ ูุฎุชูู ูุซุงููุฉ
3. ุซู ุชุฎุชูู ูู ุงูููุดูุฑุงุช ูู ุงูุดุงุดุฉ!
4. ูุธูุฑ ุดุงุดุฉ ูุงุฑุบุฉ
5. ุชุฌุฑุจุฉ ุณูุฆุฉ ุฌุฏุงู
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ:
```
1. ุงููุณุชุฎุฏู ูุญุฐู ููุดูุฑ
2. ุงูููุดูุฑ ูุฎุชูู ููุฑุงู
3. ุจุงูู ุงูููุดูุฑุงุช ุชุจูู ูุนุฑูุถุฉ
4. ุชุฌุฑุจุฉ ุณูุณุฉ ูุทุจูุนูุฉ
```

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู ุงููุญุณูุฉ

### ุณููุงุฑูู 1: ุญุฐู ููุดูุฑ
```
โ ูุจู: 6 ููุดูุฑุงุช ูุนุฑูุถุฉ
โ ุญุฐู ููุดูุฑ ูุงุญุฏ
โ ุจุนุฏ: 5 ููุดูุฑุงุช ูุนุฑูุถุฉ
โ totalPosts ููู ุจููุฏุงุฑ 1
โ Pagination ูุณุชูุฑ ุจุดูู ุตุญูุญ
```

### ุณููุงุฑูู 2: ุฅุถุงูุฉ ุชุนููู
```
โ ูุจู: 6 ููุดูุฑุงุช ูุนุฑูุถุฉ
โ ุฅุถุงูุฉ ุชุนููู ุนูู ููุดูุฑ
โ ุจุนุฏ: ููุณ ุงูู 6 ููุดูุฑุงุช ูุนุฑูุถุฉ
โ ุงูุชุนููู ูุธูุฑ ูู ูุงุฆูุฉ ุงูุชุนูููุงุช
โ ูุง ูุชู ุฅุนุงุฏุฉ ุชุญููู ุงูููุดูุฑุงุช
```

---

## ๐งช ุงุฎุชุจุงุฑุงุช ูุทููุจุฉ

### ุงุฎุชุจุงุฑ 1: ุญุฐู ููุดูุฑ
1. ุงูุชุญ ุงูุชุทุจูู ูุญููู ุนุฏุฉ ููุดูุฑุงุช
2. ุงุญุฐู ุฃู ููุดูุฑ
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: 
   - ุงูููุดูุฑ ุงููุญุฐูู ูุฎุชูู ููุฑุงู
   - ุจุงูู ุงูููุดูุฑุงุช ุชุจูู ูุนุฑูุถุฉ
   - ูุง ุชุฎุชูู ุงูุดุงุดุฉ ุฃู ุชุนุงุฏ ุชุญููู ุงูุจูุงูุงุช

### ุงุฎุชุจุงุฑ 2: ุฅุถุงูุฉ ุชุนููู
1. ุงูุชุญ ุงูุชุทุจูู ูุญููู ุนุฏุฉ ููุดูุฑุงุช
2. ุฃุถู ุชุนููู ุนูู ุฃู ููุดูุฑ
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ุงูุชุนููู ูุธูุฑ ูู ุงููุงุฆูุฉ
   - ุงูููุดูุฑุงุช ุชุจูู ูุนุฑูุถุฉ
   - ูุง ูุชู ุฅุนุงุฏุฉ ุชุญููู ุงูุดุงุดุฉ

### ุงุฎุชุจุงุฑ 3: ุญุฐู ุนุฏุฉ ููุดูุฑุงุช
1. ุงูุชุญ ุงูุชุทุจูู ูุญููู ุนุฏุฉ ููุดูุฑุงุช
2. ุงุญุฐู 3 ููุดูุฑุงุช ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ูู ููุดูุฑ ูุฎุชูู ุนูุฏ ุญุฐูู
   - `totalPosts` ููู ุจุดูู ุตุญูุญ
   - Pagination ูุณุชูุฑ ุจุงูุนูู

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุฏุงูุฉ `clearAllStates()` - ูุชู ุชุณุชุฎุฏูุ
```kotlin
fun clearAllStates() {
    currentPage = 1
    isLastPage = false
    allPosts.clear()
    _posts.value = DataState.Init
    _message.value = DataState.Init
}
```

**โ ุงุณุชุฎุฏุงูุงุช ุตุญูุญุฉ:**
- ุนูุฏ ุชุณุฌูู ุฎุฑูุฌ ุงููุณุชุฎุฏู
- ุนูุฏ ุงูุงูุชูุงู ูุดุงุดุฉ ุฃุฎุฑู ููุงุฆูุงู
- ุนูุฏ ุงูุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุนููู ูู ุดูุก ูู ุงูุตูุฑ

**โ ุงุณุชุฎุฏุงูุงุช ุฎุงุทุฆุฉ:**
- ุจุนุฏ ุญุฐู ููุดูุฑ (ููุณุญ ูู ุงูููุดูุฑุงุช!)
- ุจุนุฏ ุฅุถุงูุฉ ุชุนููู (ููุณุญ ูู ุงูููุดูุฑุงุช!)
- ุจุนุฏ ุฃู ุนูููุฉ CRUD ุนุงุฏูุฉ

### ุฏุงูุฉ `clearMessageState()` - ุงูุงุณุชุฎุฏุงู ุงูุตุญูุญ
```kotlin
fun clearMessageState() {
    _message.value = DataState.Init
}
```

**โ ุงุณุชุฎุฏุงูุงุช ุตุญูุญุฉ:**
- ุจุนุฏ ูุฌุงุญ/ูุดู ุญุฐู ููุดูุฑ
- ุจุนุฏ ูุฌุงุญ/ูุดู ุฅุถุงูุฉ ุชุนููู
- ุจุนุฏ ูุฌุงุญ/ูุดู ุชุญุฏูุซ ููุดูุฑ
- ูุฅุฎูุงุก ุฑุณุงูุฉ Toast ุฃู Snackbar

---

## โ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

### ุงูุฏูุงู ุงูุชู ุชู ุฅุตูุงุญูุง:
1. โ `deletePost()` - ุชุญุฏูุซ ุตุญูุญ ููู ุงูุจูุงูุงุช
2. โ `addComment()` - ูุง ุชูุณุญ ุงูููุดูุฑุงุช ุจุนุฏ ุงูุขู

### ุงูุฏูุงู ุงูุชู ุชุนูู ุจุดูู ุตุญูุญ:
1. โ `getPosts()` - Pagination ูุนูู ุจุดูู ููุชุงุฒ
2. โ `loadMorePosts()` - ุงูุชุญููู ุงูุชููุงุฆู ูุนูู
3. โ `refreshData()` - Pull to refresh ูุนูู
4. โ `forceRefreshFromServer()` - ูุนูู ุจุดูู ุตุญูุญ
5. โ `addPost()` - ูุญุฏุซ refresh ูุงูู (ุตุญูุญ)
6. โ `updatePost()` - ูุญุฏุซ refresh ูุงูู (ุตุญูุญ)

---

## ๐ ุงููุชูุฌุฉ

**ุชุทุจูู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู ูุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู!**

โ ูุง ูุฒูุฏ ูู ุงุฎุชูุงุก ุงูููุดูุฑุงุช ุจุดูู ุบูุฑ ูุชููุน  
โ Pagination ูุนูู ุจุณูุงุณุฉ  
โ ุนูููุงุช CRUD ุชุนูู ุจุดูู ุตุญูุญ  
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ ูุทุจูุนูุฉ  

---

**ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ! ุฌุงูุฒ ููุงุฎุชุจุงุฑ.**
